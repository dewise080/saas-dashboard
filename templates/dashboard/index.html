{% extends "layouts/base.html" %}
{% load static %}

{% block title %}Dashboard{% endblock title %}

{% block content %}
<div class="pc-container">
  <div class="pc-content">
    <div class="row">
      <!-- Overview Stat Cards -->
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <h6 class="mb-2">Total Workflows</h6>
            <h3 class="f-w-300">{{ workflows_total }}</h3>
            <span class="badge bg-brand-color-1">Active: {{ workflows_active }}</span>
            <span class="badge bg-secondary">Archived: {{ workflows_archived }}</span>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <h6 class="mb-2">Executions</h6>
            <h3 class="f-w-300">{{ executions_total }}</h3>
            <span class="badge bg-success">Finished: {{ executions_finished }}</span>
            <span class="badge bg-danger">Failed: {{ executions_failed }}</span>
            <span class="badge bg-info">Running: {{ executions_running }}</span>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <h6 class="mb-2">Users</h6>
            <h3 class="f-w-300">{{ users_total }}</h3>
            <span class="badge bg-success">Active: {{ users_active }}</span>
            <span class="badge bg-brand-color-2">Last Login: {{ users_last_login.username if users_last_login else 'N/A' }}</span>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <h6 class="mb-2">OpenAI Key Pool</h6>
            <h3 class="f-w-300">{{ keypool_stats.total }}</h3>
            <span class="badge bg-success">Assigned: {{ keypool_stats.assigned }}</span>
            <span class="badge bg-info">Available: {{ keypool_stats.available }}</span>
            <span class="badge bg-danger">Inactive: {{ keypool_stats.inactive }}</span>
          </div>
        </div>
      </div>
    </div>
    <!-- Recent Executions Table -->
    <div class="row mt-4">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h5>Recent Executions</h5>
          </div>
          <div class="card-body px-0 py-3">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Status</th>
                    <th>Workflow</th>
                    <th>Started</th>
                    <th>Stopped</th>
                  </tr>
                </thead>
                <tbody>
                  {% for exec in executions %}
                  <tr>
                    <td>{{ exec.id }}</td>
                    <td>{{ exec.status }}</td>
                    <td>{{ exec.workflowId }}</td>
                    <td>{{ exec.startedAt }}</td>
                    <td>{{ exec.stoppedAt }}</td>
                  </tr>
                  {% empty %}
                  <tr><td colspan="5">No executions found.</td></tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Workflows Table -->
    <div class="row mt-4">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h5>Workflows</h5>
          </div>
          <div class="card-body px-0 py-3">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Active</th>
                    <th>Trigger Count</th>
                    <th>Archived</th>
                  </tr>
                </thead>
                <tbody>
                  {% for wf in workflows %}
                  <tr>
                    <td>{{ wf.id }}</td>
                    <td>{{ wf.name }}</td>
                    <td>{{ wf.active }}</td>
                    <td>{{ wf.triggerCount }}</td>
                    <td>{{ wf.isArchived }}</td>
                  </tr>
                  {% empty %}
                  <tr><td colspan="5">No workflows found.</td></tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Users Table -->
    <div class="row mt-4">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h5>Users</h5>
          </div>
          <div class="card-body px-0 py-3">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>n8n User ID</th>
                    <th>OpenAI Key</th>
                  </tr>
                </thead>
                <tbody>
                  {% for user in users %}
                  <tr>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.usern8nprofile.n8n_user_id }}</td>
                    <td>{{ user.usern8nprofile.openai_api_key }}</td>
                  </tr>
                  {% empty %}
                  <tr><td colspan="4">No users found.</td></tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
